IF(USE_BLUESPEC)
    ADD_BSV_PACKAGE(BRAMStall)
    ADD_BSV_PACKAGE(AlteraM20k BRAMStall)
    ADD_BSV_PACKAGE(ProgrammableLUT)
ENDIF()

IF(VSIM_FOUND)
	VSIM_ADD_LIBRARY(work)
	VSIM_ADD_LIBRARY(bsvaltera)
	VSIM_MAP_LIBRARY(bsvlibs ${CMAKE_BINARY_DIR}/bsvlibs)
	
	## TODO: Need an automated way to rebuild this lib when .v files change
	EXECUTE_PROCESS(
    	COMMAND ${VSIM_VLIB_EXECUTABLE} bsvaltera
    	COMMAND ${VSIM_VLOG_EXECUTABLE} ${BLUESPEC_VERILOG_LIB_OPTS} -work bsvaltera ${CMAKE_CURRENT_SOURCE_DIR}/MLAB_0l.v ${CMAKE_CURRENT_SOURCE_DIR}/BRAM2.Stall.v ${CMAKE_CURRENT_SOURCE_DIR}/BRAM2.Fixed.v
    	WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
    )
ENDIF()


IF(USE_BLUESPEC)
	ADD_BLUESPEC_VERILOG_TESTBENCH(Test_BRAM2Stall BRAMStall AlteraM20k)
	ADD_BLUESPEC_VERILOG_TESTCASE(Test_BRAM2Stall mkTB_BRAM2Stall)
ENDIF()


